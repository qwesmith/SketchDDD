# TypeScript Code Generation

SketchDDD generates TypeScript interfaces, types, and optional Zod schemas for runtime validation.

## Generation

```bash
sketchddd codegen domain.sddd --target typescript --output ./src/types
```

## Features

- **Interfaces** for entities and value objects
- **Type aliases** for simple enums
- **Union types** for discriminated unions
- **Readonly** modifier for immutability
- **Optional properties** with `?` syntax
- **Array types** with `T[]` syntax

## Type Mappings

| SketchDDD | TypeScript Type |
|-----------|-----------------|
| `String` | `string` |
| `Int` | `number` |
| `Float` | `number` |
| `Bool` | `boolean` |
| `UUID` | `string` |
| `DateTime` | `Date` |
| `Date` | `string` |
| `Decimal` | `number` |
| `Email` | `string` |
| `List<T>` | `T[]` |
| `Map<K,V>` | `Map<K, V>` |
| `T?` | `T \| null` |

## Example Output

### Input

```sddd
context Users {
  entity User {
    id: UUID
    email: Email
    name: String
    role: UserRole
    preferences: UserPreferences?
    createdAt: DateTime
  }

  value UserPreferences {
    theme: Theme
    notifications: Bool
    language: String
  }

  enum UserRole = Admin | Member | Guest
  enum Theme = Light | Dark | System
}
```

### Generated Code

```typescript
// Generated by SketchDDD
// Context: Users

export interface User {
  readonly id: string;
  readonly email: string;
  readonly name: string;
  readonly role: UserRole;
  readonly preferences: UserPreferences | null;
  readonly createdAt: Date;
}

export interface UserPreferences {
  readonly theme: Theme;
  readonly notifications: boolean;
  readonly language: string;
}

export type UserRole = 'Admin' | 'Member' | 'Guest';

export type Theme = 'Light' | 'Dark' | 'System';
```

## Zod Schema Generation

For runtime validation, SketchDDD can generate Zod schemas:

```bash
sketchddd codegen domain.sddd --target typescript --zod
```

### Generated Zod Schemas

```typescript
import { z } from 'zod';

export const UserRoleSchema = z.enum(['Admin', 'Member', 'Guest']);
export type UserRole = z.infer<typeof UserRoleSchema>;

export const ThemeSchema = z.enum(['Light', 'Dark', 'System']);
export type Theme = z.infer<typeof ThemeSchema>;

export const UserPreferencesSchema = z.object({
  theme: ThemeSchema,
  notifications: z.boolean(),
  language: z.string(),
});
export type UserPreferences = z.infer<typeof UserPreferencesSchema>;

export const UserSchema = z.object({
  id: z.string().uuid(),
  email: z.string().email(),
  name: z.string(),
  role: UserRoleSchema,
  preferences: UserPreferencesSchema.nullable(),
  createdAt: z.date(),
});
export type User = z.infer<typeof UserSchema>;
```

## Usage Patterns

### With API Responses

```typescript
import { UserSchema, User } from './types/users';

async function fetchUser(id: string): Promise<User> {
  const response = await fetch(`/api/users/${id}`);
  const data = await response.json();
  return UserSchema.parse(data);
}
```

### With Form Validation

```typescript
import { UserPreferencesSchema } from './types/users';

function validatePreferences(data: unknown): boolean {
  const result = UserPreferencesSchema.safeParse(data);
  return result.success;
}
```

### With React

```tsx
import { User, UserRole } from './types/users';

interface UserCardProps {
  user: User;
}

function UserCard({ user }: UserCardProps) {
  return (
    <div>
      <h2>{user.name}</h2>
      <p>{user.email}</p>
      <span className={`badge badge-${user.role.toLowerCase()}`}>
        {user.role}
      </span>
    </div>
  );
}
```

## Project Organization

Recommended structure for TypeScript projects:

```
src/
├── types/
│   ├── index.ts          # Re-exports all types
│   ├── users.ts          # Generated: Users context
│   ├── orders.ts         # Generated: Orders context
│   └── schemas/
│       ├── users.ts      # Generated: Zod schemas
│       └── orders.ts
├── api/
│   └── ...
└── components/
    └── ...
```

### Index Re-exports

```typescript
// src/types/index.ts
export * from './users';
export * from './orders';
export * from './schemas/users';
export * from './schemas/orders';
```

## Tips

### Strict Null Checks

Ensure `strictNullChecks` is enabled in `tsconfig.json`:

```json
{
  "compilerOptions": {
    "strict": true,
    "strictNullChecks": true
  }
}
```

### Brand Types for IDs

For stronger type safety, consider branding:

```typescript
type UserId = string & { readonly __brand: 'UserId' };
type OrderId = string & { readonly __brand: 'OrderId' };
```

### Factory Functions

Add factory functions for creating instances:

```typescript
function createUser(data: Omit<User, 'id' | 'createdAt'>): User {
  return {
    ...data,
    id: crypto.randomUUID(),
    createdAt: new Date(),
  };
}
```
