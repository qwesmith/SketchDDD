# Rust Code Generation

SketchDDD generates idiomatic Rust code with full serde support and proper derive macros.

## Generation

```bash
sketchddd codegen domain.sddd --target rust --output ./src/domain
```

## Features

- **Structs** with pub fields
- **Enums** with proper variants
- **Derive macros**: Debug, Clone, PartialEq, Eq, Serialize, Deserialize
- **snake_case** field naming
- **Option<T>** for optional fields
- **Vec<T>** for lists
- **HashMap<K,V>** for maps

## Type Mappings

| SketchDDD | Rust Type | Crate |
|-----------|-----------|-------|
| `String` | `String` | std |
| `Int` | `i64` | std |
| `Float` | `f64` | std |
| `Bool` | `bool` | std |
| `UUID` | `Uuid` | uuid |
| `DateTime` | `DateTime<Utc>` | chrono |
| `Date` | `NaiveDate` | chrono |
| `Decimal` | `Decimal` | rust_decimal |
| `Email` | `String` | std |
| `List<T>` | `Vec<T>` | std |
| `Map<K,V>` | `HashMap<K,V>` | std |
| `T?` | `Option<T>` | std |

## Example Output

### Input

```sddd
context Inventory {
  entity Product {
    id: UUID
    sku: String
    name: String
    description: String?
    price: Money
    stock: Int
    tags: List<String>
  }

  value Money {
    amount: Decimal
    currency: Currency
  }

  enum Currency = USD | EUR | GBP | JPY
}
```

### Generated Code

```rust
//! Generated by SketchDDD
//! Context: Inventory

use serde::{Deserialize, Serialize};
use uuid::Uuid;
use rust_decimal::Decimal;
use std::collections::HashMap;

/// Product entity
#[derive(Debug, Clone, PartialEq, Eq, Serialize, Deserialize)]
pub struct Product {
    pub id: Uuid,
    pub sku: String,
    pub name: String,
    pub description: Option<String>,
    pub price: Money,
    pub stock: i64,
    pub tags: Vec<String>,
}

/// Money value object
#[derive(Debug, Clone, PartialEq, Eq, Serialize, Deserialize)]
pub struct Money {
    pub amount: Decimal,
    pub currency: Currency,
}

/// Currency enumeration
#[derive(Debug, Clone, Copy, PartialEq, Eq, Hash, Serialize, Deserialize)]
pub enum Currency {
    Usd,
    Eur,
    Gbp,
    Jpy,
}
```

## Recommended Dependencies

Add these to your `Cargo.toml`:

```toml
[dependencies]
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
uuid = { version = "1.0", features = ["v4", "serde"] }
chrono = { version = "0.4", features = ["serde"] }
rust_decimal = { version = "1.0", features = ["serde"] }
```

## Customization Tips

### Adding Validation

```rust
impl Money {
    pub fn new(amount: Decimal, currency: Currency) -> Result<Self, ValidationError> {
        if amount < Decimal::ZERO {
            return Err(ValidationError::new("Amount cannot be negative"));
        }
        Ok(Self { amount, currency })
    }
}
```

### Adding Behavior

```rust
impl Order {
    pub fn total(&self) -> Money {
        self.items.iter()
            .map(|item| item.subtotal())
            .sum()
    }

    pub fn can_cancel(&self) -> bool {
        matches!(self.status, OrderStatus::Pending | OrderStatus::Confirmed)
    }
}
```

### Using with Repositories

```rust
#[async_trait]
pub trait OrderRepository {
    async fn find_by_id(&self, id: Uuid) -> Result<Option<Order>, Error>;
    async fn save(&self, order: &Order) -> Result<(), Error>;
    async fn delete(&self, id: Uuid) -> Result<(), Error>;
}
```

## Crate Organization

For larger projects, consider organizing generated code:

```
src/
├── domain/
│   ├── mod.rs           # Re-exports
│   ├── orders.rs        # Generated: Orders context
│   ├── customers.rs     # Generated: Customers context
│   └── inventory.rs     # Generated: Inventory context
├── repositories/
│   └── ...
└── services/
    └── ...
```
